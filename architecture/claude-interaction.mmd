sequenceDiagram
    participant U as Пользователь
    participant UI as UI
    participant CS as Сервис Claude
    participant GS as Сервис графов
    participant TS as Сервис тезисов
    participant NS as Сервис анализа названий
    participant OS as Сервис определения происхождения
    participant MQ as Очередь сообщений
    participant Claude as Claude API
    participant DB as Базы данных
    
    U->>UI: Запрос (например, "Сгенерировать тезисы")
    UI->>CS: Запрос + параметры
    
    alt Синхронный запрос
        CS->>DB: Запрос данных (граф, категории, и т.д.)
        DB->>CS: Данные
        CS->>Claude: Форматированный запрос
        Claude->>CS: Ответ
        CS->>DB: Сохранение результата
        CS->>UI: Ответ пользователю
        UI->>U: Отображение результата
    else Асинхронный запрос (тяжелая операция)
        CS->>DB: Запрос данных
        DB->>CS: Данные
        CS->>MQ: Задача в очередь
        CS->>UI: ID задачи
        UI->>U: "Задача поставлена в очередь"
        MQ->>CS: Обработка задачи
        CS->>Claude: Форматированный запрос
        Claude->>CS: Ответ
        CS->>DB: Сохранение результата
        CS->>UI: Уведомление о завершении
        UI->>U: Отображение результата
    end
    
    U->>UI: Запрос "Создать граф из тезисов"
    UI->>GS: Запрос на генерацию графа
    GS->>TS: Получение тезисов
    TS->>GS: Данные тезисов
    GS->>CS: Запрос на преобразование
    CS->>Claude: Форматированный запрос
    Claude->>CS: Структура графа
    CS->>GS: Структура графа
    GS->>DB: Сохранение графа
    GS->>UI: Результат
    UI->>U: Отображение графа
    
    U->>UI: Запрос "Анализ названия концепции"
    UI->>NS: Запрос на анализ
    NS->>DB: Получение данных концепции
    DB->>NS: Данные концепции
    NS->>CS: Запрос на анализ
    CS->>Claude: Форматированный запрос
    Claude->>CS: Анализ и альтернативы
    CS->>NS: Результаты
    NS->>DB: Сохранение анализа
    NS->>UI: Результаты
    UI->>U: Отображение анализа
    
    U->>UI: Запрос "Определить происхождение концепции"
    UI->>OS: Запрос на определение
    OS->>DB: Получение данных
    DB->>OS: Данные концепции
    OS->>CS: Запрос на анализ
    CS->>Claude: Форматированный запрос
    Claude->>CS: Анализ происхождения
    CS->>OS: Результаты
    OS->>DB: Сохранение результатов
    OS->>UI: Результаты
    UI->>U: Отображение происхождения