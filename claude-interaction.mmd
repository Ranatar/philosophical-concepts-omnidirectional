sequenceDiagram
    participant U as Пользователь
    participant UI as UI
    participant CS as Сервис Claude
    participant MQ as Очередь сообщений
    participant Claude as Claude API
    participant DB as Базы данных
    
    U->>UI: Запрос (например, "Сгенерировать тезисы")
    UI->>CS: Запрос + параметры
    
    alt Синхронный запрос
        CS->>DB: Запрос данных (граф, категории, и т.д.)
        DB->>CS: Данные
        CS->>Claude: Форматированный запрос
        Claude->>CS: Ответ
        CS->>DB: Сохранение результата
        CS->>UI: Ответ пользователю
        UI->>U: Отображение результата
    else Асинхронный запрос (тяжелая операция)
        CS->>DB: Запрос данных
        DB->>CS: Данные
        CS->>MQ: Задача в очередь
        CS->>UI: ID задачи
        UI->>U: "Задача поставлена в очередь"
        MQ->>CS: Обработка задачи
        CS->>Claude: Форматированный запрос
        Claude->>CS: Ответ
        CS->>DB: Сохранение результата
        CS->>UI: Уведомление о завершении
        UI->>U: Отображение результата
    end
